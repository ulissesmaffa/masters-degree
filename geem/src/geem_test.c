#include <stdio.h>
#include "geem_sa.h"

int size_new_col(int col) {
    int offset = N - 1;
    return col + offset;
}

// Função responsável por buscar lateral, superior e depois computar
void compute_sa_waves(
    int row_a,
    int col_a,
    int *addr_a,
    int stride_a,
    int row_b,
    int col_b,
    int *addr_b,
    int stride_b,
    SA *sa // Passa um ponteiro para SA
) {
    stride_a = stride_a + col_a; // ajuste do stride
    stride_b = stride_b + col_b; // ajuste do stride
    int offset = N - 1;
    int new_col_a = size_new_col(col_a);
    int i, j, k, w, value_a, value_b;

    // Iteração por ondas
    for (w = 0; w < new_col_a; w++) {
        // Iteração interface lateral
        printf("\nInsert Buffer A: ");
        for (i = 0; i < N; i++) {
            int *line_base_a = addr_a + i * stride_a;
            if (w < i) {
                value_a = 0; // Região inicial com zeros
            } else if (w < i + col_a) {
                value_a = *(line_base_a + col_a - 1 - (w - i));
            } else {
                value_a = 0; // Região final com zeros
            }
            sa_add_to_buffer_a(sa, i, value_a);
            printf("li_%i[%i]=%d ", i, w, value_a);
        }

        // Iteração interface superior
        printf("\nInsert Buffer B: ");
        for (j = 0; j < N; j++) {
            int *line_base_b = addr_b + (stride_b * (row_b - 1)) - (stride_b * (w - j));
            if (w < j) {
                value_b = 0; // Região inicial com zeros
            } else if (w < j + row_b) {
                value_b = *(line_base_b + j);
            } else {
                value_b = 0; // Região final com zeros
            }
            sa_add_to_buffer_b(sa, j, value_b);
            printf("tw_%i[%i]=%d ", j, w, value_b);
        }

        printf("\n");
        // Computa a onda na SA
        printf("Computing SA wave [%i]\n", w);
        sa_compute(sa);
    }

    // Ciclos extras para finalizar computação
    int extra = row_b - 1 + col_b + N + N;
    for (k = 0; k < extra - w; k++) {
        printf("\nInsert Buffer A: ");
        for (i = 0; i < N; i++) {
            sa_add_to_buffer_a(sa, i, 0);
            printf("li_%i[%i]=%d ", i, w, 0);
        }

        printf("\nInsert Buffer B: ");
        for (j = 0; j < N; j++) {
            sa_add_to_buffer_b(sa, j, 0);
            printf("tw_%i[%i]=%d ", j, w, 0);
        }

        printf("\n");
        printf("EXTRA - Computing SA wave [%i]\n", w);
        sa_compute(sa);
        w++;
    }

    // Mostra o resultado
    printf("\nSA Results:\n");
    sa_show_result(sa);
    printf("\n");
}

int main() {
    /*
    int row_a, col_a, *addr_a, stride_a;
    int row_b, col_b, *addr_b, stride_b;
    */
    SA sa;

    sa_init(&sa); // Inicializa a SA

    int memory[] = {
        1,2,0,0,3,4,//Matriz A1 2x2 - stride 2
        7,8,0,9,10,//Matriz B1 2x2 - stride 1
        
        1,-2,-3,0,0,4,6,9,0,0,-1,0,5,//Matriz A2 3x3 - stride 2
        3,2,-1,0,0,0,-4,-5,6,0,0,0,9,1,3,//Matriz B2 3x3 - stride 3
        
        1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,//Matriz A3 4x4 - stride 0
        9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,//Matriz B3 4x4 - stride 0

        //Matriz A4 8x8 - stride 0
        1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9,1,
        //Matriz B4 8x8 - stride 0
        9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,
    
        //Matriz A5 16X16 - stride 0
        1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,
        //Matriz B5 16x16 - stride 0
        16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1, 16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1, 16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,
    
        //Matriz A6 32x32 - stride 0
        1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,
        //Matriz B6 32x32 - stride 0
        1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,
    
    };

    printf("COMPUTE SA WAVES FUNCTION: SA %iX%i\n", N, N);
    
    switch(N){
        case 2:{
            compute_sa_waves(
                2, 2, &memory[0], 2, // Matriz A1
                2, 2, &memory[6], 1, // Matriz B1
                &sa // Ponteiro para SA
            );
            break;
        }
        
        case 3:{
            compute_sa_waves(
                3, 3, &memory[11], 2, // Matriz A2
                3, 3, &memory[24], 3, // Matriz B2
                &sa // Ponteiro para SA
            );
            break;
        }

        case 4:{
            compute_sa_waves(
                4, 4, &memory[39], 0, // Matriz A3
                4, 4, &memory[55], 0, // Matriz B3
                &sa // Ponteiro para SA
            );
            break;
        }

        case 8:{
            compute_sa_waves(
                8, 8, &memory[71], 0, // Matriz A4
                8, 8, &memory[135], 0, // Matriz B4
                &sa // Ponteiro para SA
            );
            break;
        }

        case 16:{
            compute_sa_waves(
                16, 16, &memory[199], 0, // Matriz A5
                16, 16, &memory[455], 0, // Matriz B5
                &sa // Ponteiro para SA
            );
            break;
        }
        
        case 32:{
            compute_sa_waves(
                32, 32, &memory[711], 0, // Matriz A6
                32, 32, &memory[1735], 0, // Matriz B6
                &sa // Ponteiro para SA
            );
            break;
        }
    
        default:
            break;
    }


    return 0;
}



/*
OLD MEMORY
    int memory[] = {
        1, 2, 3, 4, 0, 5, 6, 7, 8, 0, 9, 10, 11, 12, 0, 13, 14, 15, 16,
        0,0, 1, 2, 3, 0,0, 4, 5, 6, // matriz A1 2x3 - stride=2
        0, 7, 8, 0, 9, 10, 0, 11, 12, 0, // matriz B1 3x2 - stride=1
        8, 2, -3, -1, 0,0, 2, -1, 0, 3, 0, 0, 4, 10, 1, -20, // matriz A2 3x4 - stride=2
        1, 2, 3, 0,0,0, 4, 5, -6, 0,0,0, -7, -1, -2, 0,0,0, 3, 2, 1, // matriz B2 4x3 - stride=3
        1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2, 3, 4, 5, 6, 7, // matriz A3 4x4 - stride 0
        9, 8, 7, 6, 5, 4, 3, 2, 1, 9, 8, 7, 6, 5, 4, 3  // matriz B3 4x4 - stride 0
    };

N=2
    compute_sa_waves(
        2, 3, &memory[21], 2, // Matriz A1
        3, 2, &memory[30], 1, // Matriz B1
        &sa // Ponteiro para SA
    );

N=3
    compute_sa_waves(
        3, 4, &memory[39], 2, // Matriz A2
        4, 3, &memory[55], 3, // Matriz B2
        &sa // Ponteiro para SA
    );
*/